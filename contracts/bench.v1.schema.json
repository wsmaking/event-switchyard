{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/event-switchyard/contracts/bench.v1.schema.json",
  "title": "Benchmark Results Schema",
  "description": "Schema for HFT Fast Path benchmark results validation",
  "type": "object",
  "required": ["version", "timestamp", "environment", "metrics", "slo_compliance"],
  "properties": {
    "version": {
      "type": "string",
      "const": "v1",
      "description": "Schema version"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Benchmark execution timestamp (ISO 8601)"
    },
    "environment": {
      "type": "object",
      "required": ["type", "config"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["local", "staging", "production", "ci"],
          "description": "Environment type"
        },
        "config": {
          "type": "object",
          "properties": {
            "fast_path_enable": {
              "type": "boolean"
            },
            "fast_path_metrics": {
              "type": "boolean"
            },
            "kafka_bridge_enable": {
              "type": "boolean"
            },
            "jvm_heap_mb": {
              "type": "integer",
              "minimum": 512
            }
          }
        },
        "git_commit": {
          "type": "string",
          "description": "Git commit SHA"
        },
        "git_branch": {
          "type": "string"
        }
      }
    },
    "profile": {
      "type": "object",
      "required": ["name", "duration_sec", "events_total"],
      "properties": {
        "name": {
          "type": "string",
          "enum": ["burst", "skew", "steady", "custom"],
          "description": "Traffic profile name"
        },
        "duration_sec": {
          "type": "integer",
          "minimum": 1
        },
        "events_total": {
          "type": "integer",
          "minimum": 100
        },
        "warmup_events": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of warmup events excluded from metrics"
        },
        "keys": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Keys used in benchmark (e.g., BTC, ETH, XRP)"
        }
      }
    },
    "metrics": {
      "type": "object",
      "required": ["fast_path", "persistence_queue", "summary"],
      "properties": {
        "fast_path": {
          "type": "object",
          "required": ["count", "process_latency_us", "drop_count"],
          "properties": {
            "count": {
              "type": "integer",
              "minimum": 0
            },
            "process_latency_us": {
              "type": "object",
              "required": ["p50", "p99", "p999"],
              "properties": {
                "min": {
                  "type": "number",
                  "minimum": 0
                },
                "max": {
                  "type": "number",
                  "minimum": 0
                },
                "mean": {
                  "type": "number",
                  "minimum": 0
                },
                "p50": {
                  "type": "number",
                  "minimum": 0
                },
                "p95": {
                  "type": "number",
                  "minimum": 0
                },
                "p99": {
                  "type": "number",
                  "minimum": 0
                },
                "p999": {
                  "type": "number",
                  "minimum": 0
                }
              }
            },
            "publish_latency_us": {
              "type": "object",
              "properties": {
                "p50": {
                  "type": "number",
                  "minimum": 0
                },
                "p99": {
                  "type": "number",
                  "minimum": 0
                },
                "p999": {
                  "type": "number",
                  "minimum": 0
                }
              }
            },
            "drop_count": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "persistence_queue": {
          "type": "object",
          "required": ["write_latency_us", "error_count", "lag"],
          "properties": {
            "write_latency_us": {
              "type": "object",
              "required": ["p99"],
              "properties": {
                "p50": {
                  "type": "number",
                  "minimum": 0
                },
                "p99": {
                  "type": "number",
                  "minimum": 0
                },
                "p999": {
                  "type": "number",
                  "minimum": 0
                }
              }
            },
            "error_count": {
              "type": "integer",
              "minimum": 0
            },
            "lag": {
              "type": "integer",
              "minimum": 0,
              "description": "Queue lag (events queued)"
            }
          }
        },
        "chronicle_queue": {
          "type": "object",
          "properties": {
            "write_count": {
              "type": "integer",
              "minimum": 0
            },
            "error_count": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "jvm": {
          "type": "object",
          "properties": {
            "heap_used_mb": {
              "type": "number",
              "minimum": 0
            },
            "heap_max_mb": {
              "type": "number",
              "minimum": 0
            },
            "thread_count": {
              "type": "integer",
              "minimum": 0
            },
            "gc_pause_ms": {
              "type": "object",
              "properties": {
                "max": {
                  "type": "number",
                  "minimum": 0
                },
                "total": {
                  "type": "number",
                  "minimum": 0
                }
              }
            }
          }
        },
        "summary": {
          "type": "object",
          "required": ["tail_ratio", "throughput_events_per_sec"],
          "properties": {
            "tail_ratio": {
              "type": "number",
              "minimum": 1,
              "description": "p99/p50 ratio (tail latency indicator)"
            },
            "throughput_events_per_sec": {
              "type": "number",
              "minimum": 0
            },
            "error_rate_percent": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },
    "slo_compliance": {
      "type": "object",
      "required": ["status", "checks"],
      "properties": {
        "status": {
          "type": "string",
          "enum": ["PASS", "WARN", "FAIL"],
          "description": "Overall SLO compliance status"
        },
        "checks": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "metric", "threshold", "actual", "passed"],
            "properties": {
              "name": {
                "type": "string",
                "description": "SLO check name"
              },
              "metric": {
                "type": "string",
                "description": "Metric path (e.g., fast_path.process_latency_us.p99)"
              },
              "operator": {
                "type": "string",
                "enum": ["<=", ">=", "==", "<", ">"],
                "default": "<="
              },
              "threshold": {
                "type": "number",
                "description": "SLO threshold value"
              },
              "actual": {
                "type": "number",
                "description": "Actual measured value"
              },
              "passed": {
                "type": "boolean",
                "description": "Whether this check passed"
              },
              "severity": {
                "type": "string",
                "enum": ["critical", "warning", "info"],
                "default": "critical"
              },
              "message": {
                "type": "string",
                "description": "Human-readable message"
              }
            }
          }
        },
        "baseline_comparison": {
          "type": "object",
          "properties": {
            "baseline_p99_us": {
              "type": "number"
            },
            "current_p99_us": {
              "type": "number"
            },
            "regression_percent": {
              "type": "number",
              "description": "Percentage regression from baseline (positive = worse)"
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "executor": {
          "type": "string",
          "description": "Who/what executed the benchmark (e.g., ci, developer-name)"
        },
        "ci_run_id": {
          "type": "string",
          "description": "CI run ID (GitHub Actions run_id, etc.)"
        },
        "pr_number": {
          "type": "integer",
          "description": "Pull request number (if applicable)"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Custom tags for categorization"
        }
      }
    }
  }
}
